在 core/desktop_automation.py 中实现宏录制与回放功能，需包含以下核心模块：

1. 操作监听器（InputListener）
   - 使用 pynput 库监听鼠标和键盘事件
   - 记录事件类型、坐标、按键、时间戳等信息
   - 过滤无效或冗余操作（如鼠标微小移动）

2. 动作序列管理器（ActionSequenceManager）
   - 将原始输入事件转换为高层UI动作（如点击控件、输入文本、拖拽等）
   - 支持动作序列的序列化与反序列化（JSON格式存储）
   - 提供动作插入、删除、修改等编辑功能

3. 宏录制器（MacroRecorder）
   - 启动/停止录制状态控制
   - 缓存录制过程中的动作序列
   - 支持设置录制上下文（目标应用、窗口标题等）

4. 宏回放引擎（MacroPlayer）
   - 按时间顺序重放动作序列
   - 支持同步与异步执行模式
   - 提供播放速度调节、断点回放等功能
   - 失败重试机制与异常处理

5. UI元素识别适配层
   - 结合 OCR 与控件树分析技术定位界面元素
   - 在回放时动态查找目标控件位置
   - 支持基于图像模板匹配的fallback机制

6. 集成到现有执行框架
   - 注册为自动化任务的一种类型（"macro" 类型）
   - 通过统一接口调用 execute(task_config) 启动宏执行
   - 支持参数化宏（传入变量替换占位符）

7. 示例配置结构
   {
     "type": "macro",
     "macro_id": "login_sequence",
     "parameters": {
       "username": "${user}",
       "password": "${pass}"
     },
     "replay_speed": 1.0,
     "retry_count": 2
   }

8. 日志与调试支持
   - 记录录制/回放全过程日志
   - 提供动作预览与步骤跳转功能
   - 可视化时间轴显示操作序列

9. 安全与权限控制
   - 敏感操作（如密码输入）自动脱敏存储
   - 宏文件数字签名验证机制
   - 用户确认机制防止恶意回放

该实现将作为桌面自动化核心能力之一，提升复杂流程自动化的开发效率。