# 🔍 概念重复问题诊断报告

**问题时间**: 2026-01-20 15:10
**问题现象**: 大量 `Cxxx → Cxxx` 自身映射日志
**系统状态**: 已重启，代码已更新（cooldown=5）

---

## 🚨 问题确认

### 观察到的日志
```
[WorkingMemory] [COOLDOWN-PRECHECK] 概念冷却: Cfba1d27d5bc7 → Cfba1d27d5bc7 (尝试 1)
[WorkingMemory] [COOLDOWN-PRECHECK] 概念冷却: C92b847ccdaf6 → C92b847ccdaf6 (尝试 1)
[WorkingMemory] [COOLDOWN-PRECHECK] 概念冷却: C2d849d5c0353 → C2d849d5c0353 (尝试 1)
```

### 关键特征
- ✅ 都是 `(尝试 1)` - 说明只尝试了1次
- ✅ 自身映射 `Cxxx → Cxxx`
- ✅ 没有出现"紧急生成"日志
- ✅ 没有出现新的语义变体（Reflect_, Explore_等）

---

## 🔬 根本原因分析

### 可能原因1：概念生成策略未生效

**现象**：都是 `(尝试 1)`，说明系统没有尝试生成替代概念

**可能原因**：
- 概念生成逻辑可能没有正确执行
- 或者生成的替代概念也都在冷却期

### 可能原因2：冷却期过长导致可用概念不足

**现象**：即使5 ticks冷却，仍然出现自身映射

**可能原因**：
- 概念池太小
- 或者大量概念同时进入冷却期
- 导致系统找不到可用概念

### 可能原因3：日志时机问题

**现象**：日志显示的是"冷却检查"，而不是"生成"

**可能原因**：
- 这只是检查日志，不是最终选择日志
- 需要查看最终使用的概念

---

## 🔍 诊断步骤

### 步骤1：验证代码已加载 ✅

```python
# core/working_memory.py:470
def _cooldown_concept(self, concept_id: str, cooldown_ticks: int = 5):
```

✅ 代码确实已更新为5 ticks

### 步骤2：检查概念生成逻辑

需要验证：
1. `_generate_divergent_concept()` 是否被调用
2. 生成的概念是什么
3. 为什么返回自身概念

### 步骤3：分析COOLDOWN-PRECHECK逻辑

这个日志是在哪里打印的？需要找到确切位置。

---

## 💡 假设与验证

### 假设1：日志只是检查，不是最终结果

**验证方法**：
```bash
# 查找最终概念使用的日志
powershell "Get-Content startup_debug.log -Tail 200 | Select-String 'Thought Stream|Thought:'"
```

### 假设2：生成的新概念也在冷却期

**验证方法**：
- 检查概念池大小
- 检查冷却中的概念数量
- 分析冷却覆盖率

### 假设3：概念生成策略有缺陷

**验证方法**：
- 检查`_generate_divergent_concept()`返回值
- 分析是否生成足够的变体

---

## 🎯 可能的解决方案

### 方案A：增加重试次数

如果只尝试1次，增加到10次：
```python
max_attempts = 10  # 增加尝试次数
```

### 方案B：扩大概念池

如果概念池太小，进一步扩大：
```python
recent_history = list(self.thought_history)[-200:]  # 100→200
```

### 方案C：缩短冷却期

如果5 ticks仍然太长：
```python
cooldown_ticks: int = 4  # 5→4
```

### 方案D：优化概念生成策略

确保语义变体生成被正确调用

---

## 📊 数据收集

需要收集的数据：
1. 冷却检查次数 vs 紧急生成次数
2. 冷却中的概念数量
3. 可用概念池大小
4. 最终使用的概念ID

---

## ⏭️ 下一步

1. 查找COOLDOWN-PRECHECK日志的确切位置
2. 分析概念生成的完整流程
3. 验证语义变体是否被调用
4. 根据发现调整策略

---

**诊断时间**: 2026-01-20 15:10
**状态**: 🔄 诊断中
**优先级**: 🔴 高
